display:
  status:
    pomodoro:
      refresh: 60

      script: |
        MINUTES = 25 # minutes in a single pomodoro

        def start
          @started_at ||= Time.now
          @pomodoros ||= 0
          refresh
        end

        def stop
          @started_at = nil
          @pomodoros +=1
          refresh
        end

        def reset
          stop
          @pomodoros = 0
          refresh
        end

      label: |
        if @started_at
          minutes_elasped = ((Time.now - @started_at) / 60).round

          if minutes_elasped >= MINUTES
            dialog 'Take a break!', '-title', 'Pomodoro'
            self.stop
          end

          [:success, "pomodoro #{MINUTES - minutes_elasped}m x#{@pomodoros}"]
        else
          'pomodoro'
        end

      control:
        action:
          start_pomodoro: self.start
          stop_pomodoro: self.stop
          reset_pomodoro: self.reset

        mouse_action:
          left_click: start_pomodoro
          right_click: stop_pomodoro
          wheel_click: reset_pomodoro
