script:
  - before: |
      ZOOMED_SUFFIX = /~(\d+)$/

control:
  action:

    copy_grouping_to_temporary_view: |
      clients = grouping

      unless clients.empty?
        # determine temporary view
        if curr_tag =~ ZOOMED_SUFFIX
          src, num = $`, $1.to_i
          dst = "#{src}~#{num+1}"
        else
          dst = "#{curr_tag}~1"
        end

        # add clients to temporary view
        curr_client_before_zoom = curr_client
        clients.each {|c| c.tag dst }

        # focus temporary view
        v = View.new(dst)
        v.focus
        curr_client_before_zoom.focus v
      end

    restore_grouping_from_temporary_view: |
      clients = grouping

      unless clients.empty?
        src = curr_tag

        if src =~ ZOOMED_SUFFIX
          # determine original view
          dst = $`

          # remove clients from temporary view
          curr_client_before_zoom = curr_client
          clients.each do |c|
            c.with_tags do
              delete src

              if empty?
                push dst
              else
                dst = self.last
              end
            end
          end

          # focus original view
          v = View.new(dst)
          v.focus
          curr_client_before_zoom.focus v
        end
      end
